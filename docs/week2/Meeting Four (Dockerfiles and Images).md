# Meeting Four (Dockerfiles and Images)

## Questions That Will be Answered
* What is a Docker Image?
* What is Dockerhub and how does it work
* How do I make own Docker images?
* How do I keep persistent storage in Docker

## Dockerhub
Docker Hub is the worldâ€™s largest repository of container images with an array of content sources including container community developers, open source projects and independent software vendors (ISV) building and distributing their code in containers. Users get access to free public repositories for storing and sharing images or can choose subscription plan for private repos. 

Go onto Docker hub and create an account

## Docker 

A Docker image is a read-only template that contains a set of instructions for creating a container that can run on the Docker platform. It provides a convenient way to package up applications and preconfigured server environments, which you can use for your own private use or share publicly with other Docker users.

For example the nginx, elasticsearch, and alpine containers were all images pulled from the Dockerhub official repository. These are saved locally and they are used later when you need them. 

## Dockerfile

Docker can build images automatically by reading the instructions from a Dockerfile. A Dockerfile is a text document that contains all the commands a user could call on the command line to assemble an image. Using docker build users can create an automated build that executes several command-line instructions in succession

This is how we build custom Docker Images. Let's take a look at the Docker file for my website and breakdown the different parts to understand how this works. Don't forget the way Docker caching works, and the reason I picked the order I did. 

    git@github.com:AntHanna23/personal-website.git


``` 
FROM ubuntu:18.04

RUN apt update && apt upgrade -y \
    && apt install -y nginx 

RUN rm -rf /etc/nginx/sites-enabled/default 

COPY start.sh /
COPY anthonyhanna.com /var/www/anthonyhanna.com
COPY nginx.conf /etc/nginx/nginx.conf
COPY anthonyhanna.conf /etc/nginx/sites-enabled/

ENTRYPOINT ./start.sh
```

## Exercise One
* Create a Docker file that has an SSH server running
* Create a user with password that can be connected to
* Install python3 
* Write Python Script that says Hello World
* Build Container and SSH and run Python Code

## Docker Volumes and Bind Mounts

Docker can have persistent storage though the container itself might be ephemeral. We do this by creating Docker volumes. Volumes work by taking a file on your host and attaching it to within the container. Volumes are the preferred mechanism for persisting data generated by and used by Docker containers. Lets do a quick example:

```
FROM oraclelinux:7-slim
ENV PACKAGE_URL https://repo.mysql.com/yum/mysql-8.0-community/docker/x86_64/mysql-community-server-minimal-8.0.2-0.1.dmr.el7.x86_64.rpm

# Install server
RUN rpmkeys --import http://repo.mysql.com/RPM-GPG-KEY-mysql \
  && yum install -y $PACKAGE_URL \
  && yum install -y libpwquality \
  && rm -rf /var/cache/yum/*
RUN mkdir /docker-entrypoint-initdb.d

VOLUME /var/lib/mysql

COPY docker-entrypoint.sh /entrypoint.sh
ENTRYPOINT ["/entrypoint.sh"]

EXPOSE 3306 33060
CMD ["mysqld"]
```
    docker pull mysql
    docker container run -d --name db -e MYSQL_ALLOW_EMPTY_PASSWORD=True mysql
    docker container inspect db

Now notice where the Volume is mounted in the container vs. on our actual machines. You can see the name of the mounted location on the host and it is not very human readable. Let us change that by naming the volume. Though this becomes more readable it is just a reference, and Docker is still using the hash as the actual file location. 

    docker volume ls
    docker container run -d --name db -e MYSQL_ALLOW_EMPTY_PASSWORD=True -v sql-db:/var/lib/mysql 
    docker volume inspect sql-db (See how much nicer the path looks)

Now we can attach multiple containers to the same database allowing them to share storage. 

    docker container run -d --name db2 -e MYSQL_ALLOW_EMPTY_PASSWORD=True -v sql-db:/var/lib/mysql 
    docker volume ls

Notice how no new volume was when running this command. These databases will share the storage. 

# Bind Mounts

Bind Mounts are great for developing in docker and though they are not used in production in most cases they can come in handy so I will show a little of that here. Make a directory and use this Dockerfile along with an index.html.

```
From nginx:latest

WORKDIR /usr/share/nginx/html

COPY index.html index.html
```
    docker container run -d --name nginx-test -p 80:80 $(pwd):/usr/share/nginx/html nginx

Now we can see changes live on the container. Open up two terminals and make a change to the current directory and see that this change happens in /usr/share/nginx/html in the container. This is great for local development.

## Exercise Two
* Create Nginx instance with bind mount
* Make a new file and navigate to it in your browser

### Optional Friday Project (Highly Encouraged)
* Get GCP Set Up
* Buy a Domain
* Make a Basic Website with your skill and interested things about you (html5up.com)
* Put it in a container 
* Deploy and have your own website
* I will be on all day Friday to help out as you guys do this 


Next week we start Github/Gitlab/CI-CD




